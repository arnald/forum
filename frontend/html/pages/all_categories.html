{{ define "content" }}
<h1 class="forum-title">Categories</h1>

<div class="main-container">
  <!-- Search and Filter Section -->
  <div class="topics-filter-section">
    <form method="GET" action="/categories" class="topics-filter-form">
      <!-- Search Bar -->
      <div class="search-wrapper">
        <input 
          type="text" 
          name="search" 
          placeholder="Search categories..." 
          value="{{ index .Filters "search" }}"
          maxlength="100" 
          class="search-input"
        />
        <button type="submit" class="search-btn">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
        </button>
      </div>

      <!-- Filter Controls -->
      <div class="filter-controls">
        <div class="filter-group">
          <label for="order_by">Sort by:</label>
          <select name="order_by" id="order_by" class="filter-select">
            <option value="created_at" {{ if eq (index $.Filters "order_by") "created_at" }}selected{{ end }}>Date Created</option>
            <option value="name" {{ if eq (index $.Filters "order_by") "name" }}selected{{ end }}>Name</option>
          </select>
        </div>

        <div class="filter-group">
          <label for="order">Order:</label>
          <select name="order" id="order" class="filter-select">
            <option value="desc" {{ if eq (index $.Filters "order") "desc" }}selected{{ end }}>Descending</option>
            <option value="asc" {{ if eq (index $.Filters "order") "asc" }}selected{{ end }}>Ascending</option>
          </select>
        </div>

        <div class="filter-buttons">
          <button type="submit" class="apply-btn">Apply</button>
          <a href="/categories" class="clear-btn">Clear</a>
        </div>
      </div>
    </form>
  </div>

  <!-- Categories Grid -->
  <div class="categories-container">
    {{ range .Categories }}
    <div class="category">
      <div class="category-wrapper">
        <div class="category-img-box">
          <a href="/category/{{ .Slug }}" class="category-link">
            <img class="category-img" src="{{ .ImagePath }}" alt="{{ .Name }}" />
          </a>
        </div>
        <div class="category-info">
          <div class="category-info-box">
            <a href="/category/{{ .Slug }}" class="category-link">
              <div class="category-title-box">
                <span
                  class="category-title-color"
                  style="background-color: {{ .Color }}"
                ></span>
                <span class="category-title">{{ .Name }}</span>
              </div>
            </a>
            <p class="category-description">{{ .Description }}</p>
          </div>
        </div>
      </div>
      <div class="category-posts">
        {{ range $index, $topic := .Topics }}
        <!-- Only show first 3 topics -->
        {{ if lt $index 3 }}
        <div class="category-post">
          <a href="/topic/{{ .ID }}" class="topic-link">
            <span class="category-post-title">
              <span class="left-arrow">&#10147;</span> {{ $topic.Title }}
            </span>
          </a>
          <span class="category-post-date">{{ $topic.CreatedAt }}</span>
        </div>
        {{ end }} {{ end }}
      </div>
    </div>
    {{ end }}
  </div>

  <!-- Pagination -->
  {{ if gt (index .Pagination "totalPages") 1 }}
  <div class="pagination-container">
    <div class="pagination">
      <!-- Previous Button -->
      {{ if (index .Pagination "has_prev") }}
        <a href="?page={{ index .Pagination "prev_page" }}&search={{ index .Filters "search" }}&order_by={{ index .Filters "order_by" }}&order={{ index .Filters "order" }}" 
           class="pagination-btn prev-btn">
          <span class="pagination-arrow previous-arrow"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"><path d="M12 2a10 10 0 1 0 10 10A10.011 10.011 0 0 0 12 2zm0 18a8 8 0 1 1 8-8 8.009 8.009 0 0 1-8 8z"/><path d="M13.293 7.293 8.586 12l4.707 4.707 1.414-1.414L11.414 12l3.293-3.293-1.414-1.414z"/></svg></span> Previous
        </a>
      {{ else }}
        <span class="pagination-btn prev-btn disabled"><span class="pagination-arrow previous-arrow"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"><path d="M12 2a10 10 0 1 0 10 10A10.011 10.011 0 0 0 12 2zm0 18a8 8 0 1 1 8-8 8.009 8.009 0 0 1-8 8z"/><path d="M13.293 7.293 8.586 12l4.707 4.707 1.414-1.414L11.414 12l3.293-3.293-1.414-1.414z"/></svg></span> Previous</span>
      {{ end }}

      <!-- Page Number -->
      <span class="page-number active">{{ index .Pagination "page" }}</span>

      <!-- Next Button -->
      {{ if (index .Pagination "has_next") }}
        <a href="?page={{ index .Pagination "next_page" }}&search={{ index .Filters "search" }}&order_by={{ index .Filters "order_by" }}&order={{ index .Filters "order" }}" 
           class="pagination-btn next-btn">
          Next <span class="pagination-arrow next-arrow"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"><path d="M12 2a10 10 0 1 0 10 10A10.011 10.011 0 0 0 12 2zm0 18a8 8 0 1 1 8-8 8.009 8.009 0 0 1-8 8z"/><path d="M9.293 8.707 12.586 12l-3.293 3.293 1.414 1.414L15.414 12l-4.707-4.707-1.414 1.414z"/></svg></span>
        </a>
      {{ else }}
        <span class="pagination-btn next-btn disabled">Next <span class="pagination-arrow next-arrow"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"><path d="M12 2a10 10 0 1 0 10 10A10.011 10.011 0 0 0 12 2zm0 18a8 8 0 1 1 8-8 8.009 8.009 0 0 1-8 8z"/><path d="M9.293 8.707 12.586 12l-3.293 3.293 1.414 1.414L15.414 12l-4.707-4.707-1.414 1.414z"/></svg></span></span>
      {{ end }}
    </div>

    <!-- Pagination Info -->
    <div class="pagination-info">
      Page {{ index .Pagination "page" }} of {{ index .Pagination "totalPages" }} ({{ index .Pagination "totalItems" }} categories total)
    </div>
  </div>
  {{ end }}
</div>
{{ end }}