{{/* Individual post detail page template.
     Displays a complete post with its content, metadata, categories, comments, and interaction options.
     Shows different actions based on user permissions (edit/delete for owners/admins). */}}
{{define "content"}}
<div class="container">
    {{/* Main post content section */}}
    <article class="post-detail">
        <header class="post-header">
            <h1>{{.Post.Title}}</h1>
            <div class="post-meta">
                <span class="author">by {{.Post.Username}}</span>
                <span class="date">{{.Post.CreatedAt.Format "Jan 2, 2006 15:04"}}</span>
            </div>
        </header>

        <div class="post-content">
            <p>{{.Post.Content}}</p>
            {{if .Post.ImagePath}}
                <div class="post-image">
                    <img src="{{.Post.ImagePath}}" alt="Post image" class="post-img">
                </div>
            {{end}}
        </div>

        {{if .Post.Categories}}
            <div class="post-categories">
                {{range .Post.Categories}}
                    <span class="category-tag">{{.}}</span>
                {{end}}
            </div>
        {{end}}

        <div class="post-actions">
            <div class="likes">
                {{if .User}}
                    <form method="POST" action="/like-post/{{.Post.ID}}" style="display: inline;">
                        <button type="submit" class="btn-like">👍 {{.Post.Likes}}</button>
                    </form>
                    <form method="POST" action="/dislike-post/{{.Post.ID}}" style="display: inline;">
                        <button type="submit" class="btn-dislike">👎 {{.Post.Dislikes}}</button>
                    </form>
                {{else}}
                    <span class="like-count">👍 {{.Post.Likes}}</span>
                    <span class="dislike-count">👎 {{.Post.Dislikes}}</span>
                {{end}}
            </div>
            {{if .User}}
                {{if or (eq .User.ID .Post.UserID) (eq .User.Role "admin") (eq .User.Role "moderator")}}
                    <div class="post-controls">
                        <a href="/edit-post/{{.Post.ID}}" class="btn-edit">Edit</a>
                        <form method="POST" action="/delete-post/{{.Post.ID}}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this post?')">
                            <button type="submit" class="btn-delete">Delete</button>
                        </form>
                    </div>
                {{end}}
            {{end}}
        </div>
    </article>

    <section class="comments-section">
        <h3>Comments</h3>

        {{if .User}}
            <form method="POST" action="/create-comment" class="comment-form">
                <input type="hidden" name="post_id" value="{{.Post.ID}}">
                <div class="form-group">
                    <label for="content">Add a comment:</label>
                    <textarea id="content" name="content" rows="4" required></textarea>
                </div>
                <button type="submit" class="btn-primary">Post Comment</button>
            </form>
        {{else}}
            <p><a href="/login">Login</a> to post comments.</p>
        {{end}}

        <div class="comments">
            {{if .Comments}}
                {{range .Comments}}
                    <div class="comment">
                        <div class="comment-header">
                            <span class="comment-author">{{.Username}}</span>
                            <span class="comment-date">{{.CreatedAt.Format "Jan 2, 2006 15:04"}}</span>
                        </div>
                        <div class="comment-content">
                            <p>{{.Content}}</p>
                        </div>
                        <div class="comment-actions">
                            <div class="comment-likes">
                                {{if $.User}}
                                    <form method="POST" action="/like-comment/{{.ID}}" style="display: inline;">
                                        <button type="submit" class="btn-like-small">👍 {{.Likes}}</button>
                                    </form>
                                    <form method="POST" action="/dislike-comment/{{.ID}}" style="display: inline;">
                                        <button type="submit" class="btn-dislike-small">👎 {{.Dislikes}}</button>
                                    </form>
                                {{else}}
                                    <span class="like-count">👍 {{.Likes}}</span>
                                    <span class="dislike-count">👎 {{.Dislikes}}</span>
                                {{end}}
                            </div>
                            {{if $.User}}
                                {{if or (eq $.User.ID .UserID) (eq $.User.Role "admin") (eq $.User.Role "moderator")}}
                                    <div class="comment-controls">
                                        <a href="/edit-comment/{{.ID}}" class="btn-edit-small">Edit</a>
                                        <form method="POST" action="/delete-comment/{{.ID}}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this comment?')">
                                            <button type="submit" class="btn-delete-small">Delete</button>
                                        </form>
                                    </div>
                                {{end}}
                            {{end}}
                        </div>
                    </div>
                {{end}}
            {{else}}
                <p class="no-comments">No comments yet. Be the first to comment!</p>
            {{end}}
        </div>
    </section>

    <div class="navigation">
        <a href="/" class="btn-secondary">Back to Posts</a>
    </div>
</div>
{{end}}